<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>ssh 사용을 단순화하기 위한 ssh config 설정 &middot; Taewan Kim</title>

  
  <link rel="stylesheet" href="http://taewan.kim/css/poole.css">
  <link rel="stylesheet" href="http://taewan.kim/css/hyde.css">
  <link rel="stylesheet" href="http://taewan.kim/css/poole-overrides.css">
  <link rel="stylesheet" href="http://taewan.kim/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://taewan.kim/css/hyde-x.css">
  <link rel="stylesheet" href="http://taewan.kim/css/highlight/github2.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://taewan.kim/touch-icon-144-precomposed.png">
  <link href="http://taewan.kim/favicon.png" rel="icon">


  
  
  
  

  <meta name="description" content="터미널 상에서 서버에 패스워드를 사용하지 않고 로그인하기, 보안에 안전한 통신, Hithub이나 BitBucket 사용, 배포 자동화 툴(Chef, Puppet) 사용 등을 위해서 ssh를 사용하는 빈도가 점차 늘어나고 있습니다. 복수의 인증서를 사용하는 환경에서는 ssh 명령의 옵션을 추가하여 인증서를 구별 해야하기 때문에 ssh 사용이 어려워지는 경향이 있습니다. ssh는 ssh config 파일을 이용하여 ssh 명령의 옵션 생략하여 간결성을 확보하고 복수의 인증서를 효과적으로 사용하는 방안을 제공합니다.">
  <meta name="keywords" content="ssh,Linux">
  
</head>
<body class="theme-base-08 layout-reverse">

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <img src="https://www.gravatar.com/avatar/e0994f88e71e61c3dede3a00e0e3dc00?s=200"
             alt="gravatar" title="Taewan Kim">
      
      <h1>Taewan Kim</h1>
      <p class="lead">민수아빠..</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://taewan.kim/">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="http://taewan.kim/post.html">all</a></li>
      
      <li class="sidebar-nav-item"><a href="http://taewan.kim/categories/bigdata.html">BigData</a></li>
      
      <li class="sidebar-nav-item"><a href="http://taewan.kim/categories/linux.html">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://taewan.kim/categories/cloud.html">cloud</a></li>
      
      <li class="sidebar-nav-item"><a href="http://taewan.kim/categories/hugo.html">hugo</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/taewanme"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      <a href="http://www.facebook.com/alvinkim082"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/taewamme"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://taewan.kim/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <p>Copyright &copy; 2016 <a href="http://taewan.kim/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a></p>
  </div>
</div>


<div class="content container">
  <div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8469722754608892"
     data-ad-slot="5594090168"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
  <div></div>
  <div></div>
  <div class="post">
    <h1>ssh 사용을 단순화하기 위한 ssh config 설정</h1>
    <span class="post-date">Jan 28, 2016 &middot; 4 minute read &middot; <a href="http://taewan.kim/blog/2016/01/28/ssh_config/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://taewan.kim/categories/ssh">ssh</a><a class="label" href="http://taewan.kim/categories/linux">Linux</a>
    </span>
    

<p>사용자 홈디렉터리의 ~/.ssh/config 파일에 host 별 설정을 추가하면 ssh 명령 사용을 단순화 할 수 있습니다.
본 문서는 ~/.ssh/config 파일의 설정만을 다룹니다. ssh와 ssh key에 대해서는 궁굼하시다면 다음 문서를 참조하시기 바랍니다.</p>

<ul>
<li>ssh 원격제어: <a href="https://opentutorials.org/module/432/3738">https://opentutorials.org/module/432/3738</a></li>
<li>ssh key: <a href="https://opentutorials.org/module/432/3742">https://opentutorials.org/module/432/3742</a></li>
</ul>

<p>ssh의 기본 사용법은 다음과 같습니다 .
다음과 같은 명령을 내릴때 ssh 명령은 &ldquo;~/.ssh/id_rsa&rdquo; 인증서를 사용하여, 52.79.103.139 서버에 ubuntu로 로그인을 시도합니다.</p>

<pre><code class="language-bash">taewanui-MacBook-Pro:~ taewan$ ssh ubuntu@52.79.103.139
Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 3.13.0-74-generic x86_64)

Last login: Mon Feb  1 01:44:13 2016 from 211.210.76.6
ubuntu@ip-172-31-11-175:~$ pwd
/home/ubuntu
ubuntu@ip-172-31-11-175:~$ 
</code></pre>

<p>기본 인증서가 다른 인증서를 사용해야 할 경우에는 다음과 같이 -i 옵션을 사용해야 합니다.</p>

<pre><code class="language-bash">taewanui-MacBook-Pro:demo taewan$ ssh ubuntu@52.79.103.139 -i ~/.ssh/aws-seoul.pem
Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 3.13.0-74-generic x86_64)

Last login: Mon Feb  1 02:10:40 2016 from 211.210.76.6
ubuntu@ip-172-31-11-175:~$ 

</code></pre>

<p>위 명령의 경우 인증서를 직접 지정해야 하기 때문에 사용하기 부담스러운 면이 있습니다. ssh을 단순하게 사용하는 방법중에 하나는 다음과 같은 alias를 사용하는 것 입니다.</p>

<pre><code class="language-bash">taewanui-MacBook-Pro:demo taewan$ alias awsssh=&quot;ssh ubuntu@52.79.103.139 -i ~/.ssh/aws-seoul.pem&quot;
taewanui-MacBook-Pro:demo taewan$ awsssh
Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 3.13.0-74-generic x86_64)

Last login: Mon Feb  1 02:23:47 2016 from 211.210.76.6
ubuntu@ip-172-31-11-175:~$
</code></pre>

<p>alias를 사용하면 명령을 쉽게 입력할 수 는 있지만 관리 비용이 증가합니다. 또한 ssh 명령은 인증서, 서버 포트, 포트포워딩 등 다양한 설정 옵션이 있기 때문에 이러한 변경을 효과적으로 대응하기에 어렵다는 단점이 있습니다.</p>

<h1 id="ssh-사용-단순화-ssh-config:0984e7ebd3dce43c74ff94df48f1ae75">ssh 사용 단순화:~/.ssh/config</h1>

<p>이러한 문제를 해법은 &ldquo;~/.ssh/config&rdquo;을 사용하는 것 입니다. 다음은 일반적인 형태의 ~/.ssh/config 파일의 내용입니다.</p>

<pre><code>### for aws
Host aws-ubuntu1
    HostName 52.79.103.139
    IdentityFile ~/.ssh/aws-seoul.pem

Host aws-ubuntu2
    HostName 52.79.103.139
    User ubuntu
    IdentityFile ~/.ssh/aws-seoul.pem   

## for git
Host github.com 
    User git
    IdentityFile ~/.ssh/id_rsa_XXXXXXXXXXXX
Host bitbucket.org
    User git
    IdentityFile ~/.ssh/id_rsa_@@@@@@@@@@@@
</code></pre>

<p>위 config에서는 2개의 아마존 서버와 github 및 bitbucket 서버 4개의 서버에 대한 ssh 설정이 서버 별로 등록되어 있습니다.
위 예제에서 아마존 aws 서버는 다음의 두 가지 방법으로 로그인 할 수 있습니다.
ssh config 설정을 사용 할 경우 복수의 인증서를 사용하는 상황에서도 ssh 명령을 단순하게 유지할 수 있습니다.</p>

<pre><code>taewanui-MacBook-Pro:demo taewan$ ssh ubuntu@aws-ubuntu1
Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 3.13.0-74-generic x86_64)

Last login: Mon Feb  1 02:37:28 2016 from 211.210.76.6
ubuntu@ip-172-31-11-175:~$ 
</code></pre>

<p>아래의 경우 aws-ubuntu2에 로그인 계정 명을 등록하였기 때문에 ssh 명령을 더욱 단순하게 사용 가능합니다.</p>

<pre><code>taewanui-MacBook-Pro:demo taewan$ ssh aws-ubuntu2
Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 3.13.0-74-generic x86_64)

Last login: Mon Feb  1 02:56:27 2016 from 211.210.76.6
ubuntu@ip-172-31-11-175:~$ 
</code></pre>

<h2 id="ssh-config-파일:0984e7ebd3dce43c74ff94df48f1ae75">~/.ssh/config 파일</h2>

<p>ssh config 설정 파일의 사용자별 위치는 &ldquo;~/.ssh/config&rdquo;입니다.</p>

<h3 id="설정-파일-권한:0984e7ebd3dce43c74ff94df48f1ae75">설정 파일 권한</h3>

<p>ssh 설정 파일은 다른 사용자가 사용할 경우 심각한 권한 문제가 발생할 수 있습니다.
따라서 다음과 같은 권한으로 설정되어야 합니다.</p>

<pre><code>chmod 440 ~/.ssh/config
</code></pre>

<h3 id="설정-파일-유형:0984e7ebd3dce43c74ff94df48f1ae75">설정 파일 유형</h3>

<p>ssh 설정 파일의 기본 형태는 다음과 같습니다.</p>

<pre><code>Host firsthost
    SSH_OPTION_1 custom_value
    SSH_OPTION_2 custom_value
    SSH_OPTION_3 custom_value

Host secondhost
    ANOTHER_OPTION custom_value

Host *host
    ANOTHER_OPTION custom_value

Host *
    CHANGE_DEFAULT custom_value
</code></pre>

<p>ssh 설정 파일의 옵션 값은 다음과 같이 3가지 방법으로 값을 설정 할 수 있습니다.
다음 3 가지는 모두 유효한 설정입니다.</p>

<pre><code>Port 4567
Port=4567
Port = 4567
</code></pre>

<h3 id="호스트-맵핑:0984e7ebd3dce43c74ff94df48f1ae75">호스트 맵핑</h3>

<p>호스트 맵핑은 Host 속성과 Hostname 속성을 이용하여 실제 호스트 URL에 맵핑을 합니다.</p>

<ul>
<li>Host: ssh 명령에 사용하는 이름</li>
<li>Hostname: Host에 지정된 이름이 매핑되는 실제 호스트 명</li>
</ul>

<pre><code>Host dev
	HostName dev.taewan.kim
	Uset admin
</code></pre>

<p>위와 같이 설정된 상태에서 &ldquo;ssh dev&rdquo;이 실행된다면 다음과 같은 명령으로 변환되어 실행됩니다.</p>

<pre><code>ssh admin@dev.taewan.kim -i ~/.ssh/id_rsa&quot;
</code></pre>

<h3 id="2차-도메인-등-와일드카드-문자-지정:0984e7ebd3dce43c74ff94df48f1ae75">2차 도메인 등 와일드카드 문자 지정</h3>

<p>다음과 같이 와일드카드 문자로 호스트 명을 지정 할 수 있습니다. 이 경우 taewan.kim의 서브 도메인에 모두 적용됩니다.</p>

<pre><code>Host *.taewan.kim
    User taewan
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/taewan.dev
</code></pre>

<h2 id="설정-파일-주요-속성:0984e7ebd3dce43c74ff94df48f1ae75">설정 파일 주요 속성</h2>

<h3 id="일반-설정:0984e7ebd3dce43c74ff94df48f1ae75">일반 설정</h3>

<ul>
<li>Hostname: 연결될 서버 호스트 명으로 사용됨.

<ul>
<li>선택적 속성</li>
<li>미 설정시 Host 값이 Hostname으로 사용됨</li>
</ul></li>
<li>User: 네트웍 커넥션에 사용되는 계정 명</li>
<li>Port: 원격 ssh 데몬이 사용하는 포트, 기본 값=22</li>
</ul>

<h3 id="네트웍-설정:0984e7ebd3dce43c74ff94df48f1ae75">네트웍 설정</h3>

<ul>
<li>ServerAliveInterval

<ul>
<li>서버에 테스트 패킷을 전송하는 주기 설정</li>
<li>초단위 설정</li>
<li>기본 값: 0</li>
</ul></li>
<li>ServerAliveCountMax

<ul>
<li>서버에 테스트용 패킷을 전송하는 횟수를 설정</li>
<li>서버에 추가적인 데이터 전송 없이 ServerAliveInterval의 최대 임계 값을 초과할 경우 커넥션 종료</li>
<li>기본값: 3</li>
<li>예: ServerAliveInterval 15, ServerAliveCountMax 3

<ul>
<li>통신없이 45초 결과후 커넥션 종료</li>
</ul></li>
</ul></li>
<li>LogLevel

<ul>
<li>클라이언트 측의 로그 레벨</li>
<li>최소 로그: QUIET</li>
<li>최대 로그: DEBUG3</li>
<li>설정 가능 값

<ul>
<li>QUIET</li>
<li>FATAL</li>
<li>ERROR</li>
<li>INFO</li>
<li>VERBOSE</li>
<li>DEBUG1</li>
<li>DEBUG2</li>
<li>DEBUG3</li>
</ul></li>
</ul></li>
<li>StrictHostKeyChecking

<ul>
<li>~/.ssh/known_hosts에 자동으로 호스트를 추가하는 설정</li>
<li>기본 설정은 저장을 질문 함</li>
<li>비활성 설정: &ldquo;no&rdquo;</li>
</ul></li>
<li>UserKnownHostsFile

<ul>
<li>연결된 호스트에 대한 정보를 남기는 파일을 지정하는 설정</li>
<li>기본 값: ~/.ssh/known_hosts</li>
<li>일반적으로 이 설정을 변경하지 않음</li>
<li>StrictHostKeyChecking을 &ldquo;no&rdquo;로 설정할 경우에 이 설정을 &ldquo;/dev/null&rdquo;로 설정ㄱㄷ유</li>
</ul></li>
<li>VisualHostKey

<ul>
<li>원격지의 호스트 키를 클라이언트 접속시 출력</li>
</ul></li>
<li>Compression

<ul>
<li>느린 네트웍 상에서 네트웍 패킷을 압축하는 옵션</li>
<li>일반적인 상황에서 사용하지 않음</li>
</ul></li>
</ul>

<h3 id="키-지정:0984e7ebd3dce43c74ff94df48f1ae75">키 지정</h3>

<ul>
<li>IdentityFile

<ul>
<li>Host 별로 사용할 키의 위치를 지정</li>
<li>기본값: 프로토콜에 따라 결정 됨

<ul>
<li>~/.ssh/id_rsa</li>
<li>~/.ssh/id_dsa</li>
</ul></li>
</ul></li>
</ul>

<h3 id="multiplexing:0984e7ebd3dce43c74ff94df48f1ae75">Multiplexing</h3>

<p>ssh는 하나의 서버에 접속하는 여러 ssh 커넥션을 하나의 TCP 커넥션을 사용하여 연결하는 기능을 제공합니다.
복수의 SSH 커넥션으로 발생하는 부하를 제거하는 용도로 적합</p>

<ul>
<li>ControlMaster

<ul>
<li>Multiplexing을 허용하는 옵션</li>
<li>허용 설정 값: auto</li>
</ul></li>
<li>ControlPath

<ul>
<li>커넥션을 제어하는 용도로 사용하는 socket 파일 지정</li>
<li>/path/to/socket/%r@%h:%p

<ul>
<li>r: username</li>
<li>h: remote host</li>
<li>p: port</li>
</ul></li>
</ul></li>
<li>ControlPersist

<ul>
<li>커넥션이 유지해야 할 시간을 초단위로 지정</li>
<li>초단위 설정</li>
<li>낮은 값을 설정할 경우 불필요한 커넥션 연결 오픈을 방지할 수 있음</li>
</ul></li>
</ul>

  </div>
  <div>
    <hr/>
	<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="/images/creative.png" /></a><a href='https://www.facebook.com/alvinkim082' target='_blank'>taewanme</a>의 저작물인 이 저작물은(는) <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">크리에이티브 커먼즈 저작자표시-비영리-동일조건변경허락 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.
    <hr/>
  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "taewankim";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>


<script type="text/javascript">
    var disqus_shortname = "taewankim";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://taewan.kim/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-73312251-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


</body>
</html>

